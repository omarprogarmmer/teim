<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ø¬Ù„ Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      direction: rtl;
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #2a9d8f;
    }
    input, button {
      font-size: 16px;
      padding: 8px;
      margin: 5px;
    }
    #timer {
      font-size: 28px;
      margin: 20px;
      color: #444;
    }
    table {
      margin-top: 20px;
      width: 100%;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    .message {
      font-size: 18px;
      color: green;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h2>Ù…Ø¤Ù‚Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù…Ø¹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h2>

  <label>Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© (Ø¯Ù‚Ø§Ø¦Ù‚):
    <input type="number" id="duration" value="25" min="1" />
  </label><br />

  <button onclick="startTimer()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</button>
  <button id="pauseButton" onclick="pauseTimer()" style="display:none;">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
  <button id="resumeButton" onclick="resumeTimer()" style="display:none;">â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù</button>

  <div id="timer">00:00</div>
  <div class="message" id="message"></div>

  <h3>Ø³Ø¬Ù„ Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h3>
  <table>
    <thead>
      <tr>
        <th>ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
        <th>Ø§Ù„Ù…Ø¯Ø© (Ø³Ø§Ø¹Ø§Øª)</th>
      </tr>
    </thead>
    <tbody id="weeksLogBody"></tbody>
  </table>

<script>
  let countdown;
  let remainingSeconds = 0;
  let isPaused = false;
  let sessionStart = null;

  // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹: Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª {startDate: "YYYY-MM-DD", minutes: number}
  let weeksLog = JSON.parse(localStorage.getItem("weeksLog")) || [];

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¬Ø§Ø±ÙŠ:
  let currentWeekStart = localStorage.getItem("currentWeekStart");
  let currentWeekMinutes = parseInt(localStorage.getItem("currentWeekMinutes")) || 0;

  // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†Ø­Ø¯Ø¯Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ…
  if (!currentWeekStart) {
    currentWeekStart = new Date().toISOString().split("T")[0];
    localStorage.setItem("currentWeekStart", currentWeekStart);
  }

  function startTimer() {
    if (remainingSeconds > 0 && isPaused) {
      resumeTimer();
      return;
    }

    const duration = parseInt(document.getElementById("duration").value);
    if (!duration || duration <= 0) {
      alert("Ø£Ø¯Ø®Ù„ Ù…Ø¯Ø© ØµØ­ÙŠØ­Ø©");
      return;
    }

    clearInterval(countdown);
    remainingSeconds = duration * 60;
    sessionStart = Date.now();
    isPaused = false;
    updateDisplay(remainingSeconds);

    document.getElementById("message").textContent = "";
    document.getElementById("pauseButton").style.display = "inline-block";
    document.getElementById("resumeButton").style.display = "none";

    countdown = setInterval(tick, 1000);
  }

  function tick() {
    if (remainingSeconds <= 0) {
      clearInterval(countdown);
      recordSession(sessionStart);
      sessionStart = null;
      document.getElementById("message").textContent = "âœ… Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©!";
      document.getElementById("pauseButton").style.display = "none";
      document.getElementById("resumeButton").style.display = "none";
      updateDisplay(0);
      checkWeekEnd();
      return;
    }

    remainingSeconds--;
    updateDisplay(remainingSeconds);
  }

  function pauseTimer() {
    clearInterval(countdown);
    isPaused = true;

    if (sessionStart) {
      recordSession(sessionStart);
      sessionStart = null;
    }

    document.getElementById("pauseButton").style.display = "none";
    document.getElementById("resumeButton").style.display = "inline-block";
    document.getElementById("message").textContent = "â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ø¤Ù‚ØªÙ‹Ø§.";
  }

  function resumeTimer() {
    if (remainingSeconds > 0) {
      sessionStart = Date.now();
      isPaused = false;
      countdown = setInterval(tick, 1000);
      document.getElementById("pauseButton").style.display = "inline-block";
      document.getElementById("resumeButton").style.display = "none";
      document.getElementById("message").textContent = "";
    }
  }

  function updateDisplay(seconds) {
    const mins = Math.floor(seconds / 60).toString().padStart(2, "0");
    const secs = (seconds % 60).toString().padStart(2, "0");
    document.getElementById("timer").textContent = `${mins}:${secs}`;
  }

  function recordSession(startTime) {
    const now = Date.now();
    const elapsedSeconds = Math.floor((now - startTime) / 1000);
    const elapsedMinutes = Math.round(elapsedSeconds / 60);

    if (elapsedMinutes <= 0) return;

    currentWeekMinutes += elapsedMinutes;
    localStorage.setItem("currentWeekMinutes", currentWeekMinutes);
    updateWeeksTable();
  }

  // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (7 Ø£ÙŠØ§Ù… Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹)
  function checkWeekEnd() {
    const start = new Date(currentWeekStart);
    const today = new Date();
    const diffDays = Math.floor((today - start) / (1000 * 60 * 60 * 24));

    if (diffDays >= 7) {
      // Ø£Ø¶Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
      weeksLog.push({
        startDate: currentWeekStart,
        minutes: currentWeekMinutes,
      });
      localStorage.setItem("weeksLog", JSON.stringify(weeksLog));

      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
      currentWeekStart = today.toISOString().split("T")[0];
      currentWeekMinutes = 0;
      localStorage.setItem("currentWeekStart", currentWeekStart);
      localStorage.setItem("currentWeekMinutes", currentWeekMinutes);

      alert("ğŸ‰ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡! Ø¨Ø¯Ø£Ù†Ø§ Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯.");
      updateWeeksTable();
    }
  }

  // Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
  function updateWeeksTable() {
    const tbody = document.getElementById("weeksLogBody");
    tbody.innerHTML = "";

    for (let week of weeksLog) {
      const hours = (week.minutes / 60).toFixed(2);
      tbody.innerHTML += `<tr><td>${week.startDate}</td><td>${hours}</td></tr>`;
    }

    // Ø£Ø¶Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¬Ø§Ø±ÙŠ ÙƒØµÙ Ù…Ù†ÙØµÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    if (currentWeekMinutes > 0) {
      const hours = (currentWeekMinutes / 60).toFixed(2);
      tbody.innerHTML += `<tr style="font-weight:bold; background:#d0f0d0;">
        <td>${currentWeekStart} (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)</td><td>${hours}</td></tr>`;
    }
  }

  // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.onload = function() {
    updateWeeksTable();
    checkWeekEnd();
  };
</script>

</body>
</html>
